<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Rotation Tool - Gestión de Rotaciones</title>
  </head>
  <body>
    <div class="rotation-tool-container">
      <!-- Header: título + botones de acción -->
      <header class="rt-header">
        <h1 class="rt-header-title">Rotation TOOL</h1>
        <div class="rt-header-actions">
          <button type="button" id="btn-attendance" class="rt-btn rt-btn-header" title="Subir / pegar Attendance">
            Attendance
          </button>
          <button type="button" id="btn-freeze" class="rt-btn rt-btn-header" title="Freeze">
            Freeze
          </button>
          <button type="button" id="btn-bloqueados" class="rt-btn rt-btn-header" title="Bloqueados">
            Bloqueados
          </button>
          <button type="button" id="btn-generar-pizarra" class="rt-btn rt-btn-header" title="Generar pizarra (quién en qué puesto)" disabled>
            Generar pizarra
          </button>
          <button type="button" id="btn-descargar-json-propuesta" class="rt-btn rt-btn-header" title="Descargar JSON de la pizarra propuesta (para comparar luego con la final)" disabled>
            Descargar JSON propuesta
          </button>
          <button type="button" id="btn-enviar-pizarra" class="rt-btn rt-btn-header rt-btn-primary" title="Enviar pizarra como referencia" disabled>
            Enviar pizarra
          </button>
        </div>
      </header>

      <!-- HC disponible + Repartir por área en una sola línea -->
      <section class="rt-hc-reparto-bar card">
        <span class="rt-hc-global-label">Disponible para distribuir</span>
        <span id="rt-hc-total" class="rt-hc-global-value">0</span>
        <span class="rt-hc-global-sublabel">personas</span>
        <span id="rt-hc-duplicados" class="rt-hc-duplicados" aria-live="polite"></span>
        <span id="rt-hc-asignados" class="rt-hc-asignados"><span id="rt-hc-sum">0</span> asignados</span>
        <span class="rt-hc-reparto-sep">·</span>
        <span class="rt-area-hc-label">Repartir por área</span>
        <div class="rt-area-hc-inputs">
          <div class="rt-area-hc-item rt-area-hc-ib">
            <label for="rt-input-ib">IB</label>
            <input type="number" id="rt-input-ib" class="rt-input-num rt-area-hc-input" min="0" value="0" data-area="IB" />
          </div>
          <div class="rt-area-hc-item rt-area-hc-iss">
            <label for="rt-input-iss">ISS</label>
            <input type="number" id="rt-input-iss" class="rt-input-num rt-area-hc-input" min="0" value="0" data-area="ISS" />
          </div>
          <div class="rt-area-hc-item rt-area-hc-ob">
            <label for="rt-input-ob">OB</label>
            <input type="number" id="rt-input-ob" class="rt-input-num rt-area-hc-input" min="0" value="0" data-area="OB" />
          </div>
          <div class="rt-area-hc-item rt-area-hc-tom">
            <label for="rt-input-tom">TOM</label>
            <input type="number" id="rt-input-tom" class="rt-input-num rt-area-hc-input" min="0" value="0" data-area="TOM" />
          </div>
          <div class="rt-area-hc-item rt-area-hc-support">
            <label for="rt-input-support">Support</label>
            <input type="number" id="rt-input-support" class="rt-input-num rt-area-hc-input" min="0" value="0" data-area="Support" />
          </div>
        </div>
        <span id="rt-area-hc-sum-msg" class="rt-area-hc-sum-msg"></span>
        <div id="rt-generar-aviso" class="rt-generar-aviso" role="alert" hidden></div>
      </section>

      <!-- Dashboard: una card blanca con áreas (Inbound, Outbound, Support) y departamentos -->
      <main class="rt-dashboard card">
        <div id="rt-dashboard-content" class="rt-dashboard-content">
          <div id="rt-dashboard-loading" class="rt-dashboard-loading">Cargando…</div>
        </div>
      </main>
    </div>

    <!-- Modal: puestos de un departamento -->
    <div id="rt-modal" class="rt-modal" role="dialog" aria-labelledby="rt-modal-title" aria-modal="true" hidden>
      <div class="rt-modal-backdrop"></div>
      <div class="rt-modal-box">
        <div class="rt-modal-header">
          <h2 id="rt-modal-title" class="rt-modal-title"></h2>
          <p id="rt-modal-area-limit" class="rt-modal-area-limit"></p>
          <button type="button" id="rt-modal-close" class="rt-modal-close" aria-label="Cerrar">×</button>
        </div>
        <div class="rt-modal-body">
          <p class="rt-modal-summary"><span id="rt-modal-summary">0</span> de <span id="rt-modal-dept-hc-label">0</span> asignados en puestos (máx. para este departamento)</p>
          <div class="rt-modal-puestos-actions">
            <button type="button" id="rt-modal-auto-btn" class="rt-btn rt-btn-sm">Distribuir automáticamente</button>
          </div>
          <div id="rt-modal-puestos" class="rt-modal-puestos"></div>
          <div id="rt-modal-asignaciones" class="rt-modal-asignaciones" hidden></div>
        </div>
        <div class="rt-modal-footer">
          <button type="button" id="rt-modal-guardar" class="rt-btn rt-btn-primary">Guardar</button>
        </div>
      </div>
    </div>

    <!-- Overlay CSV (Learning / Enfermería) -->
    <div id="rt-csv-overlay" class="rt-overlay" hidden>
      <div class="rt-overlay-backdrop"></div>
      <div class="rt-overlay-box">
        <div class="rt-csv-overlay-header">
          <h3 id="rt-csv-overlay-title" class="rt-overlay-title">Subir CSV</h3>
          <button type="button" id="rt-csv-overlay-close" class="rt-modal-close" aria-label="Cerrar">×</button>
        </div>
        <p id="rt-csv-overlay-desc" class="rt-overlay-desc">No cuenta como HC.</p>
        <div class="rt-csv-upload">
          <input type="file" id="rt-csv-file-input" accept=".csv,text/csv" />
        </div>
        <div class="rt-overlay-actions">
          <button type="button" id="rt-csv-apply" class="rt-btn rt-btn-primary">Aplicar</button>
        </div>
      </div>
    </div>

    <!-- Modal: elegir procesos para distribuir automáticamente (IB / OB) -->
    <div id="rt-auto-distrib-modal" class="rt-overlay" hidden>
      <div class="rt-overlay-backdrop"></div>
      <div class="rt-overlay-box rt-auto-distrib-box">
        <h3 id="rt-auto-distrib-title" class="rt-overlay-title">Distribuir en Inbound</h3>
        <p class="rt-overlay-desc">Selecciona entre qué procesos repartir el cupo (a veces V-RET, Grading o POUT no abren). Se usará todo el cupo del área.</p>
        <div id="rt-auto-distrib-checkboxes" class="rt-auto-distrib-checkboxes"></div>
        <div class="rt-overlay-actions">
          <button type="button" id="rt-auto-distrib-cancel" class="rt-btn">Cancelar</button>
          <button type="button" id="rt-auto-distrib-apply" class="rt-btn rt-btn-primary">Aplicar</button>
        </div>
      </div>
    </div>

    <!-- Modal: logins sin puesto + puestos con falta (asignar manualmente → skillmatrix sin verificar) -->
    <div id="rt-logins-sin-puesto-modal" class="rt-overlay" hidden>
      <div class="rt-overlay-backdrop"></div>
      <div class="rt-overlay-box rt-logins-sin-puesto-box rt-logins-sin-puesto-box-wide">
        <h3 class="rt-overlay-title">Asignar manualmente (sin formación verificada)</h3>
        <div class="rt-modal-pasos">
          <p class="rt-modal-pasos-titulo">Cómo asignar a un puesto:</p>
          <ol class="rt-modal-pasos-lista">
            <li>En la <strong>columna izquierda</strong> ves en qué puestos falta gente.</li>
            <li>En la <strong>columna derecha</strong> están las personas sin asignar (con foto).</li>
            <li>Elige un puesto en el desplegable de esa persona y pulsa <strong>«Añadir aquí»</strong>.</li>
            <li>Si un puesto tiene gente de más, usa <strong>Rebalancear</strong> para mover a quien tenga otras formaciones donde falte.</li>
          </ol>
        </div>
        <div class="rt-modal-dos-columnas">
          <div class="rt-modal-col-puestos">
            <h4 class="rt-modal-col-title">Puestos con falta de gente</h4>
            <div id="rt-logins-sin-puesto-puestos" class="rt-logins-sin-puesto-puestos"></div>
            <button type="button" id="rt-logins-sin-puesto-rebalancear" class="rt-btn rt-btn-rebalancear">Rebalancear (mover con otras formaciones)</button>
          </div>
          <div class="rt-modal-col-personas">
            <h4 class="rt-modal-col-title">Personas sin asignar</h4>
            <div id="rt-logins-sin-puesto-list" class="rt-logins-sin-puesto-list"></div>
          </div>
        </div>
        <div class="rt-overlay-actions">
          <button type="button" id="rt-logins-sin-puesto-cerrar" class="rt-btn rt-btn-primary">Cerrar</button>
        </div>
      </div>
    </div>

    <!-- Overlay para pegar logins -->
    <div id="rt-logins-overlay" class="rt-overlay" hidden>
      <div class="rt-overlay-backdrop"></div>
      <div class="rt-overlay-box">
        <h3 class="rt-overlay-title">Pegar logins</h3>
        <p class="rt-overlay-desc">Pega uno por línea. Se usará el número de <strong>logins únicos</strong> como HC (los duplicados se detectan y se eliminan).</p>
        <textarea id="rt-logins-textarea" class="rt-textarea-logins" placeholder="login1&#10;login2&#10;..."></textarea>
        <div id="rt-logins-duplicados-aviso" class="rt-logins-duplicados-aviso" hidden></div>
        <div class="rt-overlay-actions">
          <button type="button" id="rt-logins-cancel" class="rt-btn">Cancelar</button>
          <button type="button" id="rt-logins-apply" class="rt-btn rt-btn-primary">Aplicar</button>
        </div>
      </div>
    </div>

    <script type="module" src="js/rotation-tool.js"></script>
  </body>
</html>
